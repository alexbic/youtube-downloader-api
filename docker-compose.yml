version: '3.8'

# Public Version: Standalone container with built-in Redis
# Fixed limits: 2 workers, 24h TTL, 256MB Redis memory

services:
  youtube-downloader:
    image: alexbic/youtube-downloader-api:latest
    # или используйте GitHub Container Registry:
    # image: ghcr.io/alexbic/youtube-downloader-api:latest
    ports:
      - "5002:5000"
    volumes:
      - ./testing/tasks:/app/tasks
      # ВАЖНО: Раскомментируйте строку ниже и положите cookies.txt рядом с docker-compose.yml
      # для обхода защиты YouTube (экспортируйте cookies из браузера через расширение)
      # - ./cookies.txt:/app/cookies.txt
    environment:
      # Public base URL for generating absolute download links (no trailing slash)
      # Example for reverse-proxy on a subpath:
      PUBLIC_BASE_URL: ${PUBLIC_BASE_URL}
      # API Key for authentication (Bearer token)
      # If not set, API will work without authentication (not recommended for production)
      # Generate secure key: openssl rand -hex 32
      API_KEY: ${API_KEY}

      # ⚠️ PUBLIC VERSION - HARDCODED LIMITS (not configurable):
      # - Workers: 2 (fixed)
      # - TTL: 24 hours (fixed)
      # - Redis: Built-in, 256MB memory limit
      # For flexible configuration, use Pro version

      # client_meta limits
      MAX_CLIENT_META_BYTES: 16384
      MAX_CLIENT_META_DEPTH: 5
      MAX_CLIENT_META_KEYS: 200
      # Logging
      LOG_LEVEL: ${LOG_LEVEL:-INFO}
    restart: unless-stopped
